<!DOCTYPE html>
<html lang="en" data-content_root="../../" x-data="{activeSection: ''}">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#030711" />
  
  <title>rtgym.rtgym | RatatouGym 1.0.0 documentation</title>
  <meta property="og:title" content="rtgym.rtgym | RatatouGym 1.0.0 documentation" />
  <meta name="twitter:title" content="rtgym.rtgym | RatatouGym 1.0.0 documentation" />
  <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8d216cef" />
  <link rel="stylesheet" type="text/css" href="../../_static/theme.css?v=f96196c2" />
  <link rel="icon" href="../../_static/cheese.ico" />
  <link rel="search" title="Search" href="../../search.html" />
  <link rel="index" title="Index" href="../../genindex.html" />
</head>

<body x-data="{ showSidebar: false, showScrollTop: false }"
  class="min-h-screen font-sans antialiased bg-background text-foreground" :class="{ 'overflow-hidden': showSidebar }">
  <div x-cloak x-show="showSidebar"
    class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden"
    @click.self="showSidebar = false"></div><div id="page" class="relative flex flex-col min-h-screen"><a href="#content"
      class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border bg-background/90 backdrop-blur"><div class="container flex items-center h-14">
    <div class="hidden mr-4 md:flex">
      <a href="../../index.html" class="flex items-center mr-6"><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">RatatouGym 1.0.0 documentation</span>
      </a></div><button
      class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden"
      type="button" @click="showSidebar = true">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" aria-hidden="true"
        fill="currentColor">
        <path
          d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z" />
      </svg>
      <span class="sr-only">Toggle navigation menu</span>
    </button>
    <div class="flex items-center justify-between flex-1 gap-2 sm:gap-4 md:justify-end">
      <div class="flex-1 w-full md:w-auto md:flex-none"><form id="searchbox"
      action="../../search.html"
      method="get"
      class="relative flex items-center group"
      @keydown.k.window.meta="$refs.search.focus()">
  <input x-ref="search"
          name="q"
          id="search-input"
          type="search"
          aria-label="Search the docs"
          placeholder="Search ..."
          class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" />
  <kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
    <span class="text-xs">âŒ˜</span>
    K
  </kbd>
</form>
      </div>
      <nav class="flex items-center gap-1">
        
        <button
          id="theme-toggle"
          type="button"
          title="Toggle dark/light mode"
          class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9"
          aria-label="Toggle dark/light mode">
          <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
          </svg>
          <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="4" fill="currentColor"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
      </nav>
    </div>
  </div>
</header>

    <div class="flex-1"><div
        class="container md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside id="left-sidebar"
  class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full overflow-y-auto border-r border-border md:sticky"
  :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }">

    <a href="../../index.html" class="justify-start text-sm md:!hidden bg-background"><span class="font-bold text-clip whitespace-nowrap">RatatouGym 1.0.0 documentation</span>
    </a>

    <div class="relative overflow-hidden md:overflow-auto my-4 md:my-0">
      <div class="overflow-y-auto h-full w-full relative pr-6">
<h3><a href="../../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rtgym.html">rtgym package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtgym.agent.html">rtgym.agent package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtgym.arena.html">rtgym.arena package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtgym.dataclass.html">rtgym.dataclass package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rtgym.utils.html">rtgym.utils package</a></li>
</ul>

      </div>
    </div>
    <button type="button" @click="showSidebar = false"
      class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100">
      <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 96 960 960" fill="currentColor"
        stroke="none" class="h-4 w-4">
        <path
          d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z" />
      </svg>
    </button>
  </aside>
          <main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_250px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs"
     class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
  <a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground"
     href="../../index.html">
    <span class="hidden md:inline">RatatouGym 1.0.0 documentation</span>
    <svg xmlns="http://www.w3.org/2000/svg"
         height="18"
         width="18"
         viewBox="0 96 960 960"
         aria-label="Home"
         fill="currentColor"
         stroke="none"
         class="md:hidden">
      <path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z" />
    </svg>
  </a>
  
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap"
       href="../index.html">Module code</a>
    
<div class="mr-1">/</div><span aria-current="page"
        class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">rtgym.rtgym</span>
</nav>

    <div id="content" role="main">
      <h1>Source code for rtgym.rtgym</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RatatouGym is a python package that provides a simple interface to generate sensory responses</span>
<span class="sd">from a virtual agent in a virtual environment.</span>

<span class="sd">This file contains more documentation as it serves as the main API for the package.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">rtgym.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">rtgym.arena</span> <span class="kn">import</span> <span class="n">Arena</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>


<div class="viewcode-block" id="RatatouGym">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym">[docs]</a>
<span class="k">class</span> <span class="nc">RatatouGym</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The RatatouGym class is a singleton that integrates the environment, agent, behavior, and sensory streams.</span>
<span class="sd">    When initialized, the class creates an arena and an uninitialized agent.</span>
<span class="sd">    The arena is the environment the agent moves in, and the agent is the subject navigating the arena.</span>

<span class="sd">    After initialization, both the arena and the agent must be set up.</span>
<span class="sd">    For the arena, you can either choose from predefined shapes or provide a custom 2D NumPy array as the map.</span>
<span class="sd">    For the agent, you must configure sensory and behavioral parameters. Sensory is defined by a dictionary of the sensory cell types you want to simulate. Behavior is defined by parameters such as movement speed, how frequently the agent changes direction, and how it avoids obstacles.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        temporal_resolution (float): Time resolution in milliseconds. E.g. 50 will mean 50ms per timestep.</span>
<span class="sd">        spatial_resolution (float): Spatial resolution in units per pixel. E.g. 1 will mean 1cm per pixel.</span>
<span class="sd">        **kwargs: Additional keyword arguments.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from rtgym import RatatouGym</span>
<span class="sd">        &gt;&gt;&gt; gym = RatatouGym(</span>
<span class="sd">        ...     temporal_resolution=50,</span>
<span class="sd">        ...     spatial_resolution=1,</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">temporal_resolution</span><span class="p">,</span>
            <span class="n">spatial_resolution</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temporal_resolution</span> <span class="o">=</span> <span class="n">temporal_resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatial_resolution</span> <span class="o">=</span> <span class="n">spatial_resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span> <span class="o">=</span> <span class="n">Arena</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_arena_change</span><span class="p">)</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Basic get methods without trial generation</span>
    <span class="c1"># =========================================================================</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">t_res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get temporal resolution of the gym. The temporal resolution controls how</span>
<span class="sd">        continuous time in the real world is discretized into timesteps.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            float: Temporal resolution in milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">temporal_resolution</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">s_res</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get spatial resolution of the gym. The spatial resolution controls how</span>
<span class="sd">        the arena is discretized into pixels. The units are in cm per pixel.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            float: Spatial resolution in cm per pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatial_resolution</span>

<div class="viewcode-block" id="RatatouGym.to_ts">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.to_ts">[docs]</a>
    <span class="k">def</span> <span class="nf">to_ts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert time (in seconds) to number of timesteps. This is a helper function.</span>
<span class="sd">        Note that this method will round the time to the nearest integer.</span>

<span class="sd">        Args:</span>
<span class="sd">            t (int, float, np.ndarray, or torch.Tensor): Time value(s) in seconds</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int, np.ndarray, or torch.Tensor: Corresponding number of timestep(s)</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If input type is not supported.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; gym = RatatouGym(temporal_resolution=50, spatial_resolution=1)</span>
<span class="sd">            &gt;&gt;&gt; gym.to_ts(1)</span>
<span class="sd">            &gt;&gt;&gt; 20  # 1 second = 20 timesteps</span>
<span class="sd">            &gt;&gt;&gt; gym.to_ts(np.array([1, 2, 3]))</span>
<span class="sd">            &gt;&gt;&gt; array([20 40 60])</span>
<span class="sd">            &gt;&gt;&gt; gym.to_ts(torch.tensor([1, 2, 3]))</span>
<span class="sd">            &gt;&gt;&gt; tensor([20, 40, 60], dtype=torch.int32)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;torch&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span><span class="p">)</span><span class="o">.</span><span class="n">int</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unsupported type for t&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatatouGym.to_sec">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.to_sec">[docs]</a>
    <span class="k">def</span> <span class="nf">to_sec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert timesteps to seconds. This is a helper function to convert timesteps in milliseconds</span>
<span class="sd">        to seconds.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ts (int, float, np.ndarray, or torch.Tensor): Timestep value(s).</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            int, float, np.ndarray, or torch.Tensor: Corresponding time(s) in seconds.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If input type is not supported.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; gym = RatatouGym(temporal_resolution=50, spatial_resolution=1)</span>
<span class="sd">            &gt;&gt;&gt; gym.to_sec(20)</span>
<span class="sd">            &gt;&gt;&gt; 1.0  # 20 timesteps = 1 second (50ms per timestep)</span>
<span class="sd">            &gt;&gt;&gt; gym.to_sec(np.array([20, 40, 60]))</span>
<span class="sd">            &gt;&gt;&gt; array([1., 2., 3.])</span>
<span class="sd">            &gt;&gt;&gt; gym.to_sec(torch.tensor([20, 40, 60]))</span>
<span class="sd">            &gt;&gt;&gt; tensor([1., 2., 3.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">ts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span> <span class="o">/</span> <span class="mf">1e3</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span> <span class="o">/</span> <span class="mf">1e3</span>
        <span class="k">elif</span> <span class="s1">&#39;torch&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">ts</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_res</span> <span class="o">/</span> <span class="mf">1e3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unsupported type for ts&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatatouGym.to_coord">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.to_coord">[docs]</a>
    <span class="k">def</span> <span class="nf">to_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert position to coordinate indices. This method transforms continuous</span>
<span class="sd">        position values into discrete coordinate indices based on the spatial</span>
<span class="sd">        resolution of the arena.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            pos (array-like): Position values in the continuous space of the arena.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Coordinate indices in the discretized arena grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">s_res</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">arena_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the arena map. The arena map represents the spatial layout of the</span>
<span class="sd">        environment, encoding walls and free space for navigation.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Arena map of shape (H, W) where 0 represents free space </span>
<span class="sd">                and 1 represents walls. This binary representation is used </span>
<span class="sd">                internally for collision detection and path planning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">arena_map</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inv_arena_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the inverted arena map for visualization. The inverted map is useful</span>
<span class="sd">        for plotting and visualization purposes where free space should be</span>
<span class="sd">        highlighted rather than walls.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Inverted arena map of shape (H, W) where 1 represents </span>
<span class="sd">                free space and 0 represents walls. This format is optimized </span>
<span class="sd">                for visual display and matplotlib visualization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">inv_arena_map</span>

<div class="viewcode-block" id="RatatouGym.random_pos">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.random_pos">[docs]</a>
    <span class="k">def</span> <span class="nf">random_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate random valid positions in the arena. This method creates random</span>
<span class="sd">        positions that are guaranteed to be in free space (not inside walls),</span>
<span class="sd">        making them suitable for agent placement or target positioning.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            n (int): Number of random positions to generate. Must be a positive integer.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: Array of shape (n, 2) containing random positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">generate_random_pos</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
    
    <span class="c1"># =========================================================================</span>
    <span class="c1"># Set methods to initialize the arena and agent</span>
    <span class="c1"># =========================================================================</span>
    <span class="k">def</span> <span class="nf">_on_arena_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback method triggered when arena changes. This internal method ensures</span>
<span class="sd">        proper synchronization between the arena and agent components when the</span>
<span class="sd">        arena configuration is modified.</span>
<span class="sd">        </span>
<span class="sd">        The method automatically notifies the agent component about arena changes,</span>
<span class="sd">        allowing it to update its internal state and sensory configurations</span>
<span class="sd">        accordingly. This ensures that the agent&#39;s spatial representations</span>
<span class="sd">        remain consistent with the current arena layout.</span>
<span class="sd">        </span>
<span class="sd">        Note:</span>
<span class="sd">            This is an internal callback method and should not be called directly</span>
<span class="sd">            by users. It is automatically invoked when arena properties change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">_on_arena_change</span><span class="p">()</span>

<div class="viewcode-block" id="RatatouGym.load_arena">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.load_arena">[docs]</a>
    <span class="k">def</span> <span class="nf">load_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load an arena configuration from a file. This method allows loading</span>
<span class="sd">        previously saved arena configurations, enabling reproducible experiments</span>
<span class="sd">        and sharing of environment setups.</span>
<span class="sd">        </span>
<span class="sd">        The loaded arena will replace the current arena configuration entirely,</span>
<span class="sd">        including its spatial layout, dimensions, and any associated metadata.</span>
<span class="sd">        The agent will be automatically notified of the arena change through</span>
<span class="sd">        the internal callback system.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the arena file. Should be a valid file path</span>
<span class="sd">                pointing to a previously saved arena configuration. The file</span>
<span class="sd">                format depends on the arena implementation but typically uses</span>
<span class="sd">                .npz format for numpy arrays.</span>
<span class="sd">                </span>
<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the specified path does not exist.</span>
<span class="sd">            ValueError: If the file format is incompatible or corrupted.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; gym = RatatouGym(temporal_resolution=50.0, spatial_resolution=1.0)</span>
<span class="sd">            &gt;&gt;&gt; gym.load_arena(&#39;saved_environments/maze_1.npz&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatatouGym.save_arena">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.save_arena">[docs]</a>
    <span class="k">def</span> <span class="nf">save_arena</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current arena configuration to a file. This method enables</span>
<span class="sd">        persistence of arena configurations for later use, sharing, or</span>
<span class="sd">        experimental reproducibility.</span>
<span class="sd">        </span>
<span class="sd">        The saved file will contain the complete arena state including the</span>
<span class="sd">        spatial layout, dimensions, and any associated metadata. The saved</span>
<span class="sd">        arena can be later loaded using the load_arena method.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            path (str): Path where the arena file will be saved. Must have</span>
<span class="sd">                .npz extension as the arena is saved in numpy&#39;s compressed</span>
<span class="sd">                format for efficiency and compatibility.</span>
<span class="sd">                </span>
<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: If the file extension is not .npz.</span>
<span class="sd">            PermissionError: If the specified path is not writable.</span>
<span class="sd">            OSError: If there are issues with file system operations.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; gym = RatatouGym(temporal_resolution=50.0, spatial_resolution=1.0)</span>
<span class="sd">            &gt;&gt;&gt; gym.init_arena_map(shape=&#39;square&#39;, width=100, height=100)</span>
<span class="sd">            &gt;&gt;&gt; gym.save_arena(&#39;my_environments/custom_maze.npz&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># file extension is npz</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.npz&#39;</span><span class="p">,</span> <span class="s2">&quot;file extension must be .npz&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatatouGym.init_arena_map">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.init_arena_map">[docs]</a>
    <span class="k">def</span> <span class="nf">init_arena_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the arena map with a predefined geometric shape. This method</span>
<span class="sd">        calls the corresponding function in the arena class to initialize the navigation space from a set of predefined shapes.</span>
<span class="sd">        </span>
<span class="sd">        The method supports various predefined shapes commonly used in spatial</span>
<span class="sd">        navigation research, such as squares, rectangles, circles, and more</span>
<span class="sd">        complex geometries. Each shape type accepts specific parameters that</span>
<span class="sd">        define its dimensions and characteristics. Please refer to the `rtgym.arena.arena_shapes` module for more details.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Shape-specific parameters that vary depending on the</span>
<span class="sd">                selected arena geometry. Each arean shape might have different parameters. </span>
<span class="sd">                Please refer to the `rtgym.arena.arena_shapes` module for more details.</span>
<span class="sd">                </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; gym = RatatouGym(temporal_resolution=50.0, spatial_resolution=1.0)</span>
<span class="sd">            &gt;&gt;&gt; gym.init_arena_map(shape=&#39;rectangle&#39;, dimensions=[100, 100])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">init_arena_map</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="RatatouGym.set_arena_map">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.set_arena_map">[docs]</a>
    <span class="k">def</span> <span class="nf">set_arena_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arena_map</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set arena map with a custom binary layout. This method allows complete</span>
<span class="sd">        control over the arena geometry by directly specifying the spatial</span>
<span class="sd">        layout as a binary array.</span>
<span class="sd">        </span>
<span class="sd">        The custom arena map enables creation of arbitrary environments beyond</span>
<span class="sd">        the predefined shapes, allowing for complex mazes, irregular boundaries,</span>
<span class="sd">        or specialized experimental setups. The binary format uses 0 for free</span>
<span class="sd">        space and 1 for walls, following standard conventions in spatial</span>
<span class="sd">        navigation research.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            arena_map (np.ndarray): Custom arena map of shape (H, W) where</span>
<span class="sd">                0 represents free space (navigable areas) and 1 represents</span>
<span class="sd">                walls (impassable barriers). The array should be 2-dimensional</span>
<span class="sd">                with consistent data types (typically bool or int).</span>
<span class="sd">                </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If arena_map is not a 2D array or contains invalid values.</span>
<span class="sd">            TypeError: If arena_map is not a numpy array or compatible type.</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; custom_map = np.zeros((50, 50))  # 50x50 open field</span>
<span class="sd">            &gt;&gt;&gt; custom_map[0, :] = 1  # top wall</span>
<span class="sd">            &gt;&gt;&gt; custom_map[-1, :] = 1  # bottom wall</span>
<span class="sd">            &gt;&gt;&gt; custom_map[:, 0] = 1  # left wall</span>
<span class="sd">            &gt;&gt;&gt; custom_map[:, -1] = 1  # right wall</span>
<span class="sd">            &gt;&gt;&gt; gym.set_arena_map(custom_map)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">set_arena_map</span><span class="p">(</span><span class="n">arena_map</span><span class="o">=</span><span class="n">arena_map</span><span class="p">)</span></div>

    <span class="c1"># ======================================================================================</span>
    
    <span class="c1"># ======================================================================================</span>
    <span class="c1"># Sensory methods</span>
    <span class="c1"># ======================================================================================</span>
<div class="viewcode-block" id="RatatouGym.set_sensory_manually">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.set_sensory_manually">[docs]</a>
    <span class="k">def</span> <span class="nf">set_sensory_manually</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sens_type</span><span class="p">,</span> <span class="n">sensory</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;DeprecationWarning: The method &#39;set_sensory_manually&#39; is deprecated. &quot;</span>
                      <span class="s2">&quot;Potential implementation issues might cause unintended behavior. &quot;</span>
                      <span class="s2">&quot;It is recommended to implement a separate sensory class instead.&quot;</span><span class="p">)</span></div>

        <span class="c1"># self.agent.set_sensory_manually(sens_type, sensory)</span>
    <span class="c1"># ======================================================================================</span>

    <span class="c1"># ======================================================================================</span>
    <span class="c1"># Visualization methods</span>
    <span class="c1"># ======================================================================================</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_plot_dimensions</span><span class="p">(</span><span class="n">arena_map</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">):</span>
        <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">arena_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">arena_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig_width</span> <span class="o">=</span> <span class="n">fig_height</span> <span class="o">*</span> <span class="n">aspect_ratio</span>
        <span class="k">return</span> <span class="n">fig_width</span><span class="p">,</span> <span class="n">fig_height</span>

<div class="viewcode-block" id="RatatouGym.vis_gif">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.vis_gif">[docs]</a>
    <span class="k">def</span> <span class="nf">vis_gif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span><span class="p">,</span> <span class="n">return_format</span><span class="o">=</span><span class="s1">&#39;anim&#39;</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">max_frames</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an animated visualization of trajectory and heading direction.</span>
<span class="sd">        </span>
<span class="sd">        This method generates an animated plot showing the agent&#39;s path through the arena</span>
<span class="sd">        with real-time visualization of position and heading direction. The trajectory</span>
<span class="sd">        is displayed as a red line that progressively reveals the path taken, while a</span>
<span class="sd">        blue arrow indicates the agent&#39;s current heading direction at each timestep.</span>
<span class="sd">        </span>
<span class="sd">        The animation can be customized for performance by adjusting frame rate, sampling</span>
<span class="sd">        density, and maximum duration. For long trajectories, the stride and max_frames</span>
<span class="sd">        parameters help balance visualization quality with computational efficiency.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            traj: Trajectory data object containing position coordinates (int_coord, float_coord)</span>
<span class="sd">                and heading direction (hd) information. Must have shape (batch, timesteps, dims).</span>
<span class="sd">            plot_w (float): Desired width of the plot in inches. Will be automatically </span>
<span class="sd">                computed based on arena aspect ratio if not specified correctly.</span>
<span class="sd">            plot_h (float): Desired height of the plot in inches.</span>
<span class="sd">            return_format (str): Output format for the animation. Options:</span>
<span class="sd">                - &#39;anim&#39;: Returns matplotlib animation object for further manipulation</span>
<span class="sd">                - &#39;html&#39;: Returns HTML representation for Jupyter notebook display</span>
<span class="sd">            stride (int): Step size for sampling trajectory points. Higher values create</span>
<span class="sd">                faster animations by skipping frames but may lose trajectory detail.</span>
<span class="sd">                Default is 10.</span>
<span class="sd">            interval (int): Time between animation frames in milliseconds. Lower values</span>
<span class="sd">                create faster playback. Default is 50ms (20 FPS).</span>
<span class="sd">            max_frames (int): Maximum number of frames to generate regardless of trajectory</span>
<span class="sd">                length. Helps prevent memory issues with very long trajectories and</span>
<span class="sd">                ensures reasonable animation generation times. Default is 100.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.animation.FuncAnimation: Animation object that can be saved,</span>
<span class="sd">                displayed, or converted to different formats.</span>
<span class="sd">                </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If trajectory data is empty or malformed (no data along expected axis).</span>
<span class="sd">            </span>
<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # Create animation for a recorded trajectory</span>
<span class="sd">            &gt;&gt;&gt; anim = gym.vis_gif(trajectory, plot_w=8, plot_h=6, </span>
<span class="sd">            ...                    stride=5, interval=100, max_frames=50)</span>
<span class="sd">            &gt;&gt;&gt; anim.save(&#39;trajectory.gif&#39;, writer=&#39;pillow&#39;, fps=10)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">traj</span><span class="o">.</span><span class="n">int_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">traj</span><span class="o">.</span><span class="n">hd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;traj.int_coord or traj.hd has no data along the expected axis.&quot;</span><span class="p">)</span>

        <span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_plot_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">arena_map</span><span class="p">,</span> <span class="n">plot_h</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv_arena_map</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        
        <span class="c1"># Initialize the quiver arrow</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="c1"># Precompute trajectory data</span>
        <span class="n">traj_length</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">int_coord</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Calculate appropriate stride to ensure we cover the full trajectory</span>
        <span class="n">total_frames</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_frames</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">traj_length</span> <span class="o">/</span> <span class="n">stride</span><span class="p">)))</span>
        <span class="n">frames_stride</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">traj_length</span> <span class="o">/</span> <span class="n">total_frames</span><span class="p">)))</span>
        
        <span class="c1"># Precompute frame indices to ensure we show the full trajectory</span>
        <span class="n">frame_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">traj_length</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_frames</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
            <span class="n">arrow</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">arrow</span><span class="o">.</span><span class="n">set_UVC</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">arrow</span>

        <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">frame_idx</span> <span class="o">=</span> <span class="n">frame_indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="c1"># Always show the complete trajectory up to the current point</span>
            <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">frame_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">frame_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">frame_idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Get the tip position of the line</span>
                <span class="n">tip_x</span><span class="p">,</span> <span class="n">tip_y</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                
                <span class="c1"># Calculate direction based on the angle</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">hd</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">direction_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                <span class="n">direction_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                
                <span class="c1"># Update arrow position and direction</span>
                <span class="n">arrow</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">([</span><span class="n">tip_x</span><span class="p">,</span> <span class="n">tip_y</span><span class="p">])</span>
                <span class="n">arrow</span><span class="o">.</span><span class="n">set_UVC</span><span class="p">(</span><span class="n">direction_x</span><span class="p">,</span> <span class="n">direction_y</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">arrow</span>

        <span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">total_frames</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span> <span class="k">if</span> <span class="n">return_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span> <span class="k">else</span> <span class="n">anim</span></div>


<div class="viewcode-block" id="RatatouGym.vis_traj">
<a class="viewcode-back" href="../../rtgym.html#rtgym.rtgym.RatatouGym.vis_traj">[docs]</a>
    <span class="k">def</span> <span class="nf">vis_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vis_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the trajectory of the agent in the arena.</span>
<span class="sd">        </span>
<span class="sd">        This method provides flexible visualization of agent trajectories, supporting both</span>
<span class="sd">        static plotting and animated displays. The trajectory is overlaid on the arena map,</span>
<span class="sd">        showing the path taken by the agent through the environment. The visualization</span>
<span class="sd">        automatically scales to maintain proper aspect ratios and provides options for</span>
<span class="sd">        customization through various parameters.</span>
<span class="sd">        </span>
<span class="sd">        For static visualizations, the complete trajectory is displayed as a line plot</span>
<span class="sd">        over the arena. For animated visualizations, the trajectory is built up frame</span>
<span class="sd">        by frame, optionally showing the agent&#39;s heading direction as it moves.</span>

<span class="sd">        Args:</span>
<span class="sd">            traj (rtgym.dataclass.Trajectory): Trajectory object containing the agent&#39;s</span>
<span class="sd">                position data and other trajectory information to be visualized.</span>
<span class="sd">            cmap (str, optional): Colormap for the arena background. Defaults to &quot;viridis&quot;.</span>
<span class="sd">            linewidth (float, optional): Width of the trajectory line. Defaults to 1.</span>
<span class="sd">            return_format (str, optional): Format of the returned visualization. Options are:</span>
<span class="sd">                - &#39;anim&#39;: Returns matplotlib animation object</span>
<span class="sd">                - &#39;html&#39;: Returns HTML representation of animation for Jupyter notebooks</span>
<span class="sd">                - None: Returns static plot as (fig, ax) tuple</span>
<span class="sd">            height (float, optional): Height of the figure in inches. Width is automatically</span>
<span class="sd">                calculated to maintain arena aspect ratio. Defaults to 3.</span>
<span class="sd">            ax (matplotlib.axes.Axes, optional): Existing axes to plot on. If provided,</span>
<span class="sd">                figure size parameters are ignored.</span>
<span class="sd">            vis_kwargs (dict, optional): Additional keyword arguments passed to animation</span>
<span class="sd">                function when return_format is &#39;anim&#39; or &#39;html&#39;.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple or animation object: </span>
<span class="sd">                - If return_format is None: Returns (fig, ax) tuple for static plot</span>
<span class="sd">                - If return_format is &#39;anim&#39;: Returns matplotlib FuncAnimation object</span>
<span class="sd">                - If return_format is &#39;html&#39;: Returns HTML object for Jupyter display</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_plot_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">arena_map</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_format</span> <span class="o">==</span> <span class="s1">&#39;anim&#39;</span> <span class="ow">or</span> <span class="n">return_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_gif</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span><span class="p">,</span> <span class="n">return_format</span><span class="p">,</span> <span class="o">**</span><span class="n">vis_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">plot_w</span><span class="p">,</span> <span class="n">plot_h</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arena</span><span class="o">.</span><span class="n">inv_arena_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">float_coord</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>
</div>

</pre></div>
    </div></div>
          </main>
        </div>
      </div><footer class="py-6 border-t border-border md:py-0">
    <div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
      <div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
        <p class="text-sm leading-loose text-center text-muted-foreground md:text-left">Â© 2025, Zhaoze Wang @ Balasubramanian Lab&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;
      Built with <a class="font-medium underline underline-offset-4"
    href="https://www.sphinx-doc.org"
    rel="noreferrer"> Sphinx 8.2.3 </a>&nbsp;&nbsp;|&nbsp;&nbsp;
  ðŸ§€ <strong>RatatouGym</strong> - Neural Simulation Gymnasium for Spatial Navigation Research
</p>
</div>
</div>
</footer>
    </div>
    
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/theme-toggle.js?v=9ab353ff"></script>
    <script src="../../_static/external-links.js?v=fbcf3ad4"></script>
    
</body>

</html>